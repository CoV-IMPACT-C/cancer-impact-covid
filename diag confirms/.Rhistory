caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb) %>%
ggplot(aes(x = trimester, color = prevision, fill = prevision)) +
geom_point(aes(y = caida_rel), size = .7) +
geom_line(aes(x = trimester, y = caida_rel, group = prevision)) +
geom_ribbon(aes(ymin = caida_rel_lb, ymax = caida_rel_ub, group = prevision), alpha = .15) +
scale_x_discrete(expand = c(0,0)) +
labs(y = "% diagnostic confirmations reduction", x = "Trimester", fill = "Insurance", color = "Insurance",
subtitle = "", title = "Cancer diagnostic confirmations by insurance") +
geom_vline(xintercept = 1.85, linetype = "dotted", color = "red") +
theme_minimal() +
theme(legend.position = "right",
axis.title = element_text(size = 8),
axis.text = element_text(size = 8),
plot.subtitle = element_text(size = 8),
plot.title = element_text(size = 11, face = "bold"))
g3.agg <- dat.plots.agg.prev %>%
filter(time %in% 13:16) %>%
group_by(trimester, prevision) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb) %>%
ggplot(aes(x = trimester, color = prevision, fill = prevision)) +
geom_point(aes(y = caida_rel), size = .7) +
geom_line(aes(x = trimester, y = caida_rel, group = prevision)) +
geom_ribbon(aes(ymin = caida_rel_lb, ymax = caida_rel_ub, group = prevision), alpha = .15) +
scale_x_discrete(expand = c(0,0)) +
xlim(0,4)+
labs(y = "% diagnostic confirmations reduction", x = "Trimester", fill = "Insurance", color = "Insurance",
subtitle = "", title = "Cancer diagnostic confirmations by insurance") +
geom_vline(xintercept = 1.85, linetype = "dotted", color = "red") +
theme_minimal() +
theme(legend.position = "right",
axis.title = element_text(size = 8),
axis.text = element_text(size = 8),
plot.subtitle = element_text(size = 8),
plot.title = element_text(size = 11, face = "bold"))
g1.a <- ggarrange(g1.agg, ncol = 2, widths = c(4,1))
g1 <- ggarrange(g1.a, g2.agg, g3.agg, ncol = 1)
g1
g3.agg
g3.agg <- dat.plots.agg.prev %>%
filter(time %in% 13:16) %>%
group_by(trimester, prevision) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb) %>%
ggplot(aes(x = trimester, color = prevision, fill = prevision)) +
geom_point(aes(y = caida_rel), size = .7) +
geom_line(aes(x = trimester, y = caida_rel, group = prevision)) +
geom_ribbon(aes(ymin = caida_rel_lb, ymax = caida_rel_ub, group = prevision), alpha = .15) +
#  scale_x_discrete(expand = c(0,0)) +
xlim(0,4)+
labs(y = "% diagnostic confirmations reduction", x = "Trimester", fill = "Insurance", color = "Insurance",
subtitle = "", title = "Cancer diagnostic confirmations by insurance") +
geom_vline(xintercept = 1.85, linetype = "dotted", color = "red") +
theme_minimal() +
theme(legend.position = "right",
axis.title = element_text(size = 8),
axis.text = element_text(size = 8),
plot.subtitle = element_text(size = 8),
plot.title = element_text(size = 11, face = "bold"))
g1.a <- ggarrange(g1.agg, ncol = 2, widths = c(4,1))
g1 <- ggarrange(g1.a, g2.agg, g3.agg, ncol = 1)
g3.agg <- dat.plots.agg.prev %>%
filter(time %in% 13:16) %>%
group_by(trimester, prevision) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb) %>%
ggplot(aes(x = trimester, color = prevision, fill = prevision)) +
geom_point(aes(y = caida_rel), size = .7) +
geom_line(aes(x = trimester, y = caida_rel, group = prevision)) +
geom_ribbon(aes(ymin = caida_rel_lb, ymax = caida_rel_ub, group = prevision), alpha = .15) +
#  scale_x_discrete(expand = c(0,0)) +
xlim(0,4)
g3.agg
g3.agg <- dat.plots.agg.prev %>%
filter(time %in% 13:16) %>%
group_by(trimester, prevision) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb) %>%
ggplot(aes(x = trimester, color = prevision, fill = prevision)) +
geom_point(aes(y = caida_rel), size = .7) +
geom_line(aes(x = trimester, y = caida_rel, group = prevision)) +
geom_ribbon(aes(ymin = caida_rel_lb, ymax = caida_rel_ub, group = prevision), alpha = .15)
g3.agg
small <- subset(mtcars, cyl == 4)
big <- subset(mtcars, cyl > 4)
ggplot(small, aes(mpg, wt, colour = factor(cyl))) +
geom_point() +
lims(colour = c("4", "6", "8"))
ggplot(big, aes(mpg, wt, colour = factor(cyl))) +
geom_point() +
lims(colour = c("4", "6", "8"))
g3.agg <- dat.plots.agg.prev %>%
filter(time %in% 13:16) %>%
group_by(trimester, prevision) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb) %>%
ggplot(aes(x = trimester, color = prevision, fill = prevision)) +
geom_point(aes(y = caida_rel), size = .7) +
geom_line(aes(x = trimester, y = caida_rel, group = prevision)) +
geom_ribbon(aes(ymin = caida_rel_lb, ymax = caida_rel_ub, group = prevision), alpha = .15) +
#  scale_x_discrete(expand = c(0,0)) +
coord_cartesian(xlim = c(0,4))+
labs(y = "% diagnostic confirmations reduction", x = "Trimester", fill = "Insurance", color = "Insurance",
subtitle = "", title = "Cancer diagnostic confirmations by insurance") +
geom_vline(xintercept = 1.85, linetype = "dotted", color = "red") +
theme_minimal() +
theme(legend.position = "right",
axis.title = element_text(size = 8),
axis.text = element_text(size = 8),
plot.subtitle = element_text(size = 8),
plot.title = element_text(size = 11, face = "bold"))
g3.agg
g3.agg <- dat.plots.agg.prev %>%
filter(time %in% 13:16) %>%
group_by(trimester, prevision) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb) %>%
ggplot(aes(x = trimester, color = prevision, fill = prevision)) +
geom_point(aes(y = caida_rel), size = .7) +
geom_line(aes(x = trimester, y = caida_rel, group = prevision)) +
geom_ribbon(aes(ymin = caida_rel_lb, ymax = caida_rel_ub, group = prevision), alpha = .15) +
coord_cartesian(xlim = c(0,4))+
scale_x_discrete(expand = c(0,0)) +
labs(y = "% diagnostic confirmations reduction", x = "Trimester", fill = "Insurance", color = "Insurance",
subtitle = "", title = "Cancer diagnostic confirmations by insurance") +
geom_vline(xintercept = 1.85, linetype = "dotted", color = "red") +
theme_minimal() +
theme(legend.position = "right",
axis.title = element_text(size = 8),
axis.text = element_text(size = 8),
plot.subtitle = element_text(size = 8),
plot.title = element_text(size = 11, face = "bold"))
g3.agg
g1 <- ggarrange(g1.a, g2.agg, g3.agg, ncol = 1)
g1.agg <- dat.plots.agg %>%
filter(year == 2020) %>%
group_by(week) %>%
summarise(count = sum(count),
yhat = sum(yhat),
cf = sum(cf),
ub = sum(ub),
lb = sum(lb),
cf_ub = sum(cf_ub),
cf_lb = sum(cf_lb) ) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb) %>%
ggplot(aes(x = as.numeric(week), y = caida_rel)) +
geom_line() +
geom_point(size = .7) +
geom_ribbon(aes(ymin = caida_rel_lb, ymax = caida_rel_ub), alpha = .15) +
scale_x_continuous(breaks = seq(5, 53, 6), expand = c(0,0)) +
labs(y = "% diagnostic confirmations reduction", x = "Week",
subtitle = "", title = "All cancer diagnostic confirmations") +
geom_vline(xintercept = 11, linetype = "dotted", color = "red") +
theme_minimal() +
theme(legend.position = "right",
axis.title = element_text(size = 8),
axis.text = element_text(size = 8),
plot.subtitle = element_text(size = 8),
plot.title = element_text(size = 11, face = "bold"))
g2.agg <- dat.plots.agg.sexo %>%
filter(year == 2020) %>%
group_by(week, sexo) %>%
summarise(count = sum(count),
yhat = sum(yhat),
cf = sum(cf),
ub = sum(ub),
lb = sum(lb),
cf_ub = sum(cf_ub),
cf_lb = sum(cf_lb) ) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb) %>%
ggplot(aes(x = week, y = caida_rel, color = sexo, fill = sexo)) +
geom_point(size = .7) +
geom_line(aes(x = week, group = sexo)) +
geom_ribbon(aes(ymin = caida_rel_lb, ymax = caida_rel_ub, group = sexo), alpha = .15) +
scale_x_discrete(breaks = seq(5, 53, 6), expand = c(0,0)) +
labs(y = "% diagnostic confirmations reduction", x = "Week", fill = "Sex", color = "Sex",
subtitle = "", title = "Cancer diagnostic confirmations by sex") +
geom_vline(xintercept = 11, linetype = "dotted", color = "red") +
theme_minimal() +
theme(legend.position = "right",
axis.title = element_text(size = 8),
axis.text = element_text(size = 8),
plot.subtitle = element_text(size = 8),
plot.title = element_text(size = 11, face = "bold"))
g3.agg <- dat.plots.agg.prev %>%
filter(time %in% 13:16) %>%
group_by(trimester, prevision) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb) %>%
ggplot(aes(x = trimester, color = prevision, fill = prevision)) +
geom_point(aes(y = caida_rel), size = .7) +
geom_line(aes(x = trimester, y = caida_rel, group = prevision)) +
geom_ribbon(aes(ymin = caida_rel_lb, ymax = caida_rel_ub, group = prevision), alpha = .15) +
coord_cartesian(xlim = c(0,4))+
scale_x_discrete(expand = c(0,0)) +
labs(y = "% diagnostic confirmations reduction", x = "Trimester", fill = "Insurance", color = "Insurance",
subtitle = "", title = "Cancer diagnostic confirmations by insurance") +
geom_vline(xintercept = 1.85, linetype = "dotted", color = "red") +
theme_minimal() +
theme(legend.position = "right",
axis.title = element_text(size = 8),
axis.text = element_text(size = 8),
plot.subtitle = element_text(size = 8),
plot.title = element_text(size = 11, face = "bold"))
g1.a <- ggarrange(g1.agg, ncol = 2, widths = c(4,1))
g1 <- ggarrange(g1.a, g2.agg, g3.agg, ncol = 1)
g1
#ggsave(plot = g1,
#filename = "C:/Users/sflor/Dropbox/Trabajo/ANID-Covid/Analisis IMED/paper/ges fig1 sexo.pdf",
#device = "pdf", dpi = "retina", width = 6, height = 6)
dat.plots.agg.prev %>%
filter(time %in% 13:16) %>%
group_by(trimester, prevision) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb)
dat.plots.agg.prev %>%
filter(time %in% 13:16) %>%
group_by(trimester, prevision) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb,
sems = 13)
dat.plots.agg.prev %>%
filter(time %in% 13:16) %>%
group_by(trimester, prevision) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb,
sems = 13) %>%
uncount(sems)
dat.plots.agg.prev %>%
filter(time %in% 13:16) %>%
group_by(trimester, prevision) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb,
sems = 13) %>%
uncount(sems) %>%
mutate(semana = c(1:52, 1:52))
dat.plots.agg.prev %>%
filter(time %in% 13:16) %>%
group_by(trimester, prevision) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb,
sems = 13) %>%
uncount(sems) %>%
ungroup() %>%
mutate(semana = c(1:52, 1:52))
ggplot(aes(x = trimester, color = prevision, fill = prevision)) +
geom_point(aes(y = caida_rel), size = .7) +
geom_line(aes(x = trimester, y = caida_rel, group = prevision)) +
geom_ribbon(aes(ymin = caida_rel_lb, ymax = caida_rel_ub, group = prevision), alpha = .15) +
#  coord_cartesian(xlim = c(0,4))+
scale_x_discrete(breaks = seq(5, 53, 6), expand = c(0,0)) +
labs(y = "% diagnostic confirmations reduction", x = "Trimester", fill = "Insurance", color = "Insurance",
subtitle = "", title = "Cancer diagnostic confirmations by insurance") +
geom_vline(xintercept = 11, linetype = "dotted", color = "red") +
theme_minimal() +
theme(legend.position = "right",
axis.title = element_text(size = 8),
axis.text = element_text(size = 8),
plot.subtitle = element_text(size = 8),
plot.title = element_text(size = 11, face = "bold"))
g3.agg <- dat.plots.agg.prev %>%
filter(time %in% 13:16) %>%
group_by(trimester, prevision) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb,
sems = 13) %>%
uncount(sems) %>%
ungroup() %>%
mutate(semana = c(1:52, 1:52)) %>%
ggplot(aes(x = trimester, color = prevision, fill = prevision)) +
geom_point(aes(y = caida_rel), size = .7) +
geom_line(aes(x = trimester, y = caida_rel, group = prevision)) +
geom_ribbon(aes(ymin = caida_rel_lb, ymax = caida_rel_ub, group = prevision), alpha = .15) +
#  coord_cartesian(xlim = c(0,4))+
scale_x_discrete(breaks = seq(5, 53, 6), expand = c(0,0)) +
labs(y = "% diagnostic confirmations reduction", x = "Trimester", fill = "Insurance", color = "Insurance",
subtitle = "", title = "Cancer diagnostic confirmations by insurance") +
geom_vline(xintercept = 11, linetype = "dotted", color = "red") +
theme_minimal() +
theme(legend.position = "right",
axis.title = element_text(size = 8),
axis.text = element_text(size = 8),
plot.subtitle = element_text(size = 8),
plot.title = element_text(size = 11, face = "bold"))
g1.a <- ggarrange(g1.agg, ncol = 2, widths = c(4,1))
g1 <- ggarrange(g1.a, g2.agg, g3.agg, ncol = 1)
g1
g3.agg <- dat.plots.agg.prev %>%
filter(time %in% 13:16) %>%
group_by(trimester, prevision) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb,
sems = 13) %>%
uncount(sems) %>%
ungroup() %>%
mutate(semana = c(1:52, 1:52)) %>%
ggplot(aes(x = semana, color = prevision, fill = prevision)) +
geom_point(aes(y = caida_rel), size = .7) +
geom_line(aes(x = semana, y = caida_rel, group = prevision)) +
geom_ribbon(aes(ymin = caida_rel_lb, ymax = caida_rel_ub, group = prevision), alpha = .15) +
#  coord_cartesian(xlim = c(0,4))+
scale_x_discrete(breaks = seq(5, 53, 6), expand = c(0,0)) +
labs(y = "% diagnostic confirmations reduction", x = "Week", fill = "Insurance", color = "Insurance",
subtitle = "", title = "Cancer diagnostic confirmations by insurance") +
geom_vline(xintercept = 11, linetype = "dotted", color = "red") +
theme_minimal() +
theme(legend.position = "right",
axis.title = element_text(size = 8),
axis.text = element_text(size = 8),
plot.subtitle = element_text(size = 8),
plot.title = element_text(size = 11, face = "bold"))
g1.a <- ggarrange(g1.agg, ncol = 2, widths = c(4,1))
g1 <- ggarrange(g1.a, g2.agg, g3.agg, ncol = 1)
g1
g3.agg <- dat.plots.agg.prev %>%
filter(time %in% 13:16) %>%
group_by(trimester, prevision) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb,
sems = 13) %>%
uncount(sems) %>%
ungroup() %>%
mutate(semana = c(1:52, 1:52)) %>%
ggplot(aes(x = semana, color = prevision, fill = prevision)) +
geom_point(aes(y = caida_rel), size = .7) +
geom_line(aes(x = semana, y = caida_rel, group = prevision)) +
geom_ribbon(aes(ymin = caida_rel_lb, ymax = caida_rel_ub, group = prevision), alpha = .15) +
#  coord_cartesian(xlim = c(0,4))+
scale_x_continuous(breaks = seq(5, 53, 6), expand = c(0,0)) +
labs(y = "% diagnostic confirmations reduction", x = "Week", fill = "Insurance", color = "Insurance",
subtitle = "", title = "Cancer diagnostic confirmations by insurance") +
geom_vline(xintercept = 11, linetype = "dotted", color = "red") +
theme_minimal() +
theme(legend.position = "right",
axis.title = element_text(size = 8),
axis.text = element_text(size = 8),
plot.subtitle = element_text(size = 8),
plot.title = element_text(size = 11, face = "bold"))
g1.a <- ggarrange(g1.agg, ncol = 2, widths = c(4,1))
g1 <- ggarrange(g1.a, g2.agg, g3.agg, ncol = 1)
g1
g2.agg <- dat.plots.agg.sexo %>%
filter(year == 2020) %>%
group_by(week, sexo) %>%
summarise(count = sum(count),
yhat = sum(yhat),
cf = sum(cf),
ub = sum(ub),
lb = sum(lb),
cf_ub = sum(cf_ub),
cf_lb = sum(cf_lb) ) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb) %>%
ggplot(aes(x = as.numeric(week), y = caida_rel, color = sexo, fill = sexo)) +
geom_point(size = .7) +
geom_line(aes(x = week, group = sexo)) +
geom_ribbon(aes(ymin = caida_rel_lb, ymax = caida_rel_ub, group = sexo), alpha = .15) +
scale_x_continuous(breaks = seq(5, 53, 6), expand = c(0,0)) +
labs(y = "% diagnostic confirmations reduction", x = "Week", fill = "Sex", color = "Sex",
subtitle = "", title = "Cancer diagnostic confirmations by sex") +
geom_vline(xintercept = 11, linetype = "dotted", color = "red") +
theme_minimal() +
theme(legend.position = "right",
axis.title = element_text(size = 8),
axis.text = element_text(size = 8),
plot.subtitle = element_text(size = 8),
plot.title = element_text(size = 11, face = "bold"))
g1 <- ggarrange(g1.a, g2.agg, g3.agg, ncol = 1)
g2.agg <- dat.plots.agg.sexo %>%
filter(year == 2020) %>%
group_by(week, sexo) %>%
summarise(count = sum(count),
yhat = sum(yhat),
cf = sum(cf),
ub = sum(ub),
lb = sum(lb),
cf_ub = sum(cf_ub),
cf_lb = sum(cf_lb) ) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb) %>%
ggplot(aes(x = as.numeric(week), y = caida_rel, color = sexo, fill = sexo)) +
geom_point(size = .7) +
geom_line(aes(x = as.numeric(week), group = sexo)) +
geom_ribbon(aes(ymin = caida_rel_lb, ymax = caida_rel_ub, group = sexo), alpha = .15) +
scale_x_continuous(breaks = seq(5, 53, 6), expand = c(0,0)) +
labs(y = "% diagnostic confirmations reduction", x = "Week", fill = "Sex", color = "Sex",
subtitle = "", title = "Cancer diagnostic confirmations by sex") +
geom_vline(xintercept = 11, linetype = "dotted", color = "red") +
theme_minimal() +
theme(legend.position = "right",
axis.title = element_text(size = 8),
axis.text = element_text(size = 8),
plot.subtitle = element_text(size = 8),
plot.title = element_text(size = 11, face = "bold"))
g2.agg
g1 <- ggarrange(g1.a, g2.agg, g3.agg, ncol = 1)
g1
g1.agg <- dat.plots.agg %>%
filter(year == 2020) %>%
group_by(week) %>%
summarise(count = sum(count),
yhat = sum(yhat),
cf = sum(cf),
ub = sum(ub),
lb = sum(lb),
cf_ub = sum(cf_ub),
cf_lb = sum(cf_lb) ) %>%
mutate(caida_abs = cf-yhat,
caida_abs_ub = cf_ub-ub,
caida_abs_lb = cf_lb-lb,
caida_rel = caida_abs*100 /cf,
caida_rel_ub = caida_abs_ub*100 /cf_ub,
caida_rel_lb = caida_abs_lb*100 /cf_lb) %>%
ggplot(aes(x = as.numeric(week), y = caida_rel)) +
geom_line() +
geom_point(size = .7) +
geom_ribbon(aes(ymin = caida_rel_lb, ymax = caida_rel_ub), alpha = .25) +
scale_x_continuous(breaks = seq(5, 53, 6), expand = c(0,0)) +
labs(y = "% diagnostic confirmations reduction", x = "Week",
subtitle = "", title = "All cancer diagnostic confirmations") +
geom_vline(xintercept = 11, linetype = "dotted", color = "red") +
theme_minimal() +
theme(legend.position = "right",
axis.title = element_text(size = 8),
axis.text = element_text(size = 8),
plot.subtitle = element_text(size = 8),
plot.title = element_text(size = 11, face = "bold"))
g1.a <- ggarrange(g1.agg, ncol = 2, widths = c(4,1))
g1 <- ggarrange(g1.a, g2.agg, g3.agg, ncol = 1)
g1
ggsave(plot = g1,
filename = "output/plots/paper diagconf fig1.pdf",
device = "pdf", dpi = "retina", width = 5, height = 8)
